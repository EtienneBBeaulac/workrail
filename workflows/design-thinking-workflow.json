{
  "id": "design-thinking-workflow",
  "name": "Design Thinking Workflow",
  "description": "A structured-reflective design thinking process: Empathize → Define → multi-round Ideate → Synthesize → Prototype (learning artifact) → Test plan → Iterate (test/learn/refine).",
  "version": "0.0.1",
  "preconditions": [
    "User can describe the problem/opportunity and constraints",
    "Agent can create and update a single canonical design doc file for resumption"
  ],
  "clarificationPrompts": [
    "What problem/opportunity are we trying to address?",
    "Who are the users/personas and what is the primary job-to-be-done?",
    "What constraints matter? (time, tooling, policy, platform, scope)",
    "What would success look like? What metrics would tell us this worked?",
    "Are there any non-negotiable principles or anti-goals?",
    "What is the intended deliverable? (proposal, spec, roadmap, prototype API, etc.)"
  ],
  "metaGuidance": [
    "Design thinking is for learning: reduce risk by validating assumptions early with cheap prototypes + feedback.",
    "Non-linear loop: Empathize ↔ Define ↔ Ideate ↔ Prototype ↔ Test ↔ Iterate; jump backwards when learning contradicts framing.",
    "Human-centered: anchor decisions in persona needs + context; avoid designing for yourself.",
    "Separate divergent vs convergent: ideate without judging; evaluate only during synthesis.",
    "Prototype to learn, not to ship: build the smallest artifact that answers one learning question.",
    "Test to falsify: seek disconfirming evidence; update POV/HMW when assumptions break.",
    "Bias toward action: prefer tangible artifacts over analysis; show, don’t tell.",
    "Artifact standard (Empathize): persona + journey map + 5 observations + 5 insights.",
    "Artifact standard (Define): POV statement + HMW questions + success metrics + key tensions.",
    "Artifact standard (Prototype): learning question + artifact + what would falsify it.",
    "Artifact standard (Test): what worked/failed + confusions + updated assumptions + candidate changes.",
    "Maintain an append-only Idea Backlog with DT-### IDs tracked in the design doc; keep Unknowns and Assumptions explicit.",
    "Style: short bullets and structured headings; end each step with a 'Next Input' checklist.",
    "Doc-first execution: after Phase 0A, the designDocPath is the canonical source of truth. Keep chat outputs short.",
    "Loop semantics: loop body steps may repeat across iterations; runConditions are evaluated per-iteration; do not rely on chat memory across iterations.",
    "If blocked, state what is missing and stop (do not invent).",
    "Workflow manifest: structured-reflective; requires file write/read; resumption via designDocPath; outputs: short chat + doc updates."
  ],
  "functionDefinitions": [
    {
      "name": "ideaEntryTemplate",
      "definition": "Use this template for each idea entry:\n- Idea ID: DT-###\n- Title: …\n- One-liner: …\n- Category: protocol | UX | authoring | observability | reliability | tooling | packaging | policy | other\n- Addresses: (pain/insight/constraint this targets)\n- Inspiration: (what prompted it)\n- Why it might work: …\n- Key risks: …\n- Notes: …\n\nID rule: Allocate the next DT-### from the design doc section `## Counters` (e.g., `Next DT ID: DT-001`) and increment it after each new idea."
    },
    {
      "name": "clusterTemplate",
      "definition": "Use this template for each cluster/theme:\n- Theme name: …\n- Why these ideas belong together (1 line): …\n- Member idea IDs: DT-…\n- What it enables: …\n- Biggest risk/unknown: …"
    },
    {
      "name": "prototypeSpecTemplate",
      "definition": "Use this template for a minimal prototype spec:\n## Goal\n## Non-goals\n## Prototype learning question\n## Prototype artifact (what you built)\n## Proposed API / Interface (if applicable)\n- Inputs\n- Outputs\n- Invariants\n- Error cases (as data)\n## Migration strategy\n## Pre-mortem (how this fails)\n## Test plan\n"
    },
    {
      "name": "testPlanTemplate",
      "definition": "Use this template for the test/dogfood plan:\n## Scenarios to run\n## Agents/models/IDEs to test\n## Pass/fail metrics\n## Instrumentation needed\n## Rollback/contingency\n"
    },
    {
      "name": "feedbackCaptureTemplate",
      "definition": "Use this template to capture test feedback:\n## What we tried\n## What worked\n## What failed\n## Confusions / friction\n## New insights\n## Updated assumptions (confirmed/invalidated)\n## Candidate changes\n"
    }
  ],
  "steps": [
    {
      "id": "phase-0-triage",
      "title": "Phase 0: Triage the Problem & Scope",
      "prompt": "Capture the initial problem framing (structured, but reflective).\n\nNOTE: In Phase 0A you will create a canonical design doc and persist these outputs. For this step, prioritize clarity and completeness.\n\nDeliverable (bullets under headings):\n## Problem / Opportunity\n- …\n## Primary user / persona + job-to-be-done\n- …\n## Constraints\n- Hard: …\n- Soft: …\n## Non-negotiable principles\n- …\n## Anti-goals / out-of-scope\n- …\n## Intended deliverable\n- …\n\nReflection prompts (answer briefly):\n- What are we implicitly assuming?\n- What is most ambiguous right now?\n\nEnd with 'Next Input' checklist: what you still need from the user before proceeding.",
      "agentRole": "You are a product/engineering facilitator. Make the problem concrete, bounded, and testable without prematurely solving it.",
      "requireConfirmation": true
    },
    {
      "id": "phase-0a-init-design-doc",
      "title": "Phase 0A: Initialize Canonical Design Doc (Resumption Anchor)",
      "prompt": "Create a single canonical design doc that will be the source of truth for the rest of this workflow.\n\nDeliverable:\n1) Choose and confirm a file path: `designDocPath`\n   - Default suggestion: `ideas/<short-slug>-design-thinking.md`\n2) Create the file (if missing) and write the initial skeleton sections:\n   - Context / Problem\n   - Persona\n   - POV + HMW\n   - Success criteria\n   - Idea Backlog (append-only)\n   - Clusters\n   - Decision Log (append-only)\n   - Prototype Spec\n   - Test Plan\n   - Iteration Notes\n   - Counters (DT IDs)\n3) Persist Phase 0 outputs into the doc under the appropriate sections.\n\nIn `Counters`, initialize:\n- Next DT ID: DT-001\n\nState (must be explicit):\n- Set `designDocPath` to the chosen path.\nChat output: only confirm `designDocPath` and list any missing inputs before proceeding.",
      "agentRole": "You create a resumption-proof anchor artifact and ensure all future work is doc-first.",
      "requireConfirmation": true
    },
    {
      "id": "phase-1-empathize",
      "title": "Phase 1: Empathize (Constraints, Reality, and Pain)",
      "prompt": "Empathize using whatever evidence exists (user experience, known failures, technical constraints).\n\nDoc-first: Update `designDocPath` with the deliverable below.\nChat: Provide only a short recap + the 'Next Input' checklist.\n\nDeliverable (bullets under headings):\n## Persona card (primary)\n- Name: …\n- Context: …\n- Goals: …\n- Pains: …\n- Constraints: …\n- Quotes/observations (from evidence you have): …\n\n## Journey map (lightweight)\n- Step | Pain | Opportunity\n- …\n\n## Observations (5)\n- …\n## Insights (5)\n- …\n\nEvidence discipline (required):\n- Each Insight must reference at least one Observation or Quote/observation above.\n- If you can’t tie it back to evidence, label it explicitly as an Assumption (do not present it as fact).\n\n## Evidence\n- Facts we have: …\n- Evidence gaps: …\n\n## Constraints (environment/tooling/model)\n- …\n\n## Observed pain themes (5–10)\n- …\n\n## Unknowns (explicit list)\n- …\n\n## Interpretation risks (3)\n- What might we be misreading or over-generalizing?\n- What evidence would contradict our top 1–2 insights?\n- What could be \"working as designed\" (not actually a problem)?\n\nReflection prompts (answer briefly):\n- Which pain themes are likely symptoms vs root causes?\n- What would we need to observe to disprove our top 1–2 interpretations?\n\nEnd with 'Next Input' checklist.",
      "agentRole": "You synthesize user needs and reality constraints. No solution ideation yet; only clarify the landscape.",
      "requireConfirmation": false
    },
    {
      "id": "phase-2-define",
      "title": "Phase 2: Define (POV + HMW + Success Criteria)",
      "prompt": "Turn empathy into a precise definition (structured, but reflective).\n\nDoc-first: Update `designDocPath` with the deliverable below.\nChat: Provide only a short recap + the 'Next Input' checklist.\n\nDeliverable (bullets under headings):\n## POV (Point of View)\nUse this format:\n- [Persona] needs [need] because [insight].\n\n## Problem statement (2–4 lines)\n- …\n\n## Alternative framings (2)\n- If we are wrong about the core problem, what else could it be?\n- What would be a radically simpler interpretation?\n\nAnchoring check (required): If you cannot produce two plausible alternative framings, say so explicitly and recommend going back to Empathize before proceeding.\n\n## How might we… (3–7)\n- …\n\n## Success criteria (measurable where possible)\n- …\n\n## Key tensions / tradeoffs\n- …\n\n## Assumptions\n- …\n\n## Riskiest assumption (pick one)\n- …\n\n## What would change our mind?\n- …\n\n## Out-of-scope\n- …\n\nReflection prompts (answer briefly):\n- What would change our mind about the problem framing?\n- What is the riskiest assumption?\n\nEnd with a 'Proceeding to Ideation' readiness check and a 'Next Input' checklist.",
      "agentRole": "You translate messy input into crisp, testable statements and ensure we are solving the right problem.",
      "requireConfirmation": true
    },
    {
      "id": "phase-3-ideation-loop",
      "type": "loop",
      "title": "Phase 3: Ideation (4 Rounds)",
      "loop": {
        "type": "for",
        "count": 4,
        "maxIterations": 5,
        "iterationVar": "ideationRound"
      },
      "body": [
        {
          "id": "ideation-round-1-general",
          "title": "Ideation Round 1: General Divergence",
          "runCondition": { "var": "ideationRound", "equals": 1 },
          "prompt": "Generate a broad set of ideas directly relevant to the defined problem.\n\nDoc-first: Append ideas to the Idea Backlog in `designDocPath` (append-only).\nDT IDs (required): For each new idea, assign the next DT-### from `## Counters` and increment it.\nRules:\n- Aim for 15–25 ideas.\n- No judging; record quickly.\n- Use the ideaEntryTemplate for each entry.\n\nDeliverable:\n## Idea Backlog (Round 1)\n- Append 15–25 idea entries\n## Emerging patterns (5 bullets)\n- …\n\nReflection prompts (brief, required, \u22643 bullets):\n- Which idea categories are underrepresented so far?\n- What is the simplest idea we are dismissing too quickly?\n- What assumption seems to be driving most of our ideas?\n\nChat: short recap + 'Next Input' checklist.",
          "agentRole": "You are in divergent mode: generate many plausible solutions without evaluation. Optimize for breadth and clarity.",
          "functionReferences": ["ideaEntryTemplate()"]
        },
        {
          "id": "ideation-round-2-orthogonal",
          "title": "Ideation Round 2: Orthogonal / Unrelated Inspiration",
          "runCondition": { "var": "ideationRound", "equals": 2 },
          "prompt": "Generate ideas that are intentionally NOT obvious extensions of Round 1.\n\nDoc-first: Append ideas to the Idea Backlog in `designDocPath` (append-only).\nTechniques:\n- Analogies from unrelated domains (compilers, logistics, game design, finance, healthcare, aviation)\n- Inversions (what if the opposite were true?)\n- Constraints as creativity (assume no state, assume no JSON, assume only files, assume only events)\n\nConstraint inversion (required):\n- Add 5 ideas that assume an explicit hard constraint chosen from the list above, and explain how the constraint changes the solution.\n\nRules:\n- Aim for 15–25 ideas total.\n- Use the ideaEntryTemplate for each entry.\n\nDeliverable:\n## Idea Backlog (Round 2)\n- Append 15–25 idea entries\n## Interesting analogies (3 bullets)\n- …\n\nReflection prompts (brief, required, \u22643 bullets):\n- Which analogy created the most non-obvious leverage?\n- What is the simplest idea we are dismissing too quickly?\n- What assumption seems to be driving most of our ideas?\n\nChat: short recap + 'Next Input' checklist.",
          "agentRole": "You are a creative catalyst. Break local maxima and introduce non-obvious alternatives.",
          "functionReferences": ["ideaEntryTemplate()"]
        },
        {
          "id": "ideation-round-3-combinatorial",
          "title": "Ideation Round 3: Build-on / Combine / Mutate",
          "runCondition": { "var": "ideationRound", "equals": 3 },
          "prompt": "Generate ideas that stem from the existing backlog.\n\nDoc-first: Append ideas to the Idea Backlog in `designDocPath` (append-only).\nTechniques:\n- Combine two ideas into one stronger concept\n- Turn an idea into a product primitive\n- Identify missing pieces required to make a good idea real\n\nRules:\n- Aim for 10–20 derived ideas.\n- Use the ideaEntryTemplate for each entry.\n\nDeliverable:\n## Derived ideas (Round 3)\n- Append 10–20 idea entries\n## Candidate concept packages (5)\n- Package name: … | member DT-IDs: … | what it enables: …\n\nReflection prompts (brief, required, \u22643 bullets):\n- What critical primitive seems to be missing for the best packages to work?\n- What is the simplest idea we are dismissing too quickly?\n- What assumption seems to be driving most of our ideas?\n\nChat: short recap + 'Next Input' checklist.",
          "agentRole": "You are a systems designer. Turn raw ideas into cohesive primitives and packages.",
          "functionReferences": ["ideaEntryTemplate()"]
        },
        {
          "id": "ideation-round-4-coverage-sweep",
          "title": "Ideation Round 4: Coverage Sweep & Blind Spot Hunt",
          "runCondition": { "var": "ideationRound", "equals": 4 },
          "prompt": "Audit the idea space for blind spots.\n\nDoc-first: Append ideas to the Idea Backlog in `designDocPath` (append-only).\nChecklist:\n- Did we address: protocol, resumption, authoring UX, validation, dashboard/observability, model variability, external workflow packaging, loops correctness, capability negotiation?\n- DT artifact coverage: persona/journey quality, POV clarity, prototype learnability, falsifiability, testability.\n- What did we NOT consider (security/policy, performance, compatibility, migration, testing strategy)?\n\nRules:\n- Add 10–15 missing ideas.\n- Use the ideaEntryTemplate for each entry.\n\nDeliverable:\n## Additional ideas (Round 4)\n- Append 10–15 idea entries\n## Coverage map\n- Dimension | coverage level (low/med/high) | top DT-IDs\n\nReflection prompts (brief, required, \u22643 bullets):\n- Where would we most likely regret not exploring further?\n- What category did we avoid because it felt uncomfortable or \"too big\"?\n- What assumption seems to be driving most of our ideas?\n\nChat: short recap + 'Next Input' checklist.",
          "agentRole": "You are a thorough reviewer. Ensure we didn’t miss major dimensions of the problem space.",
          "functionReferences": ["ideaEntryTemplate()"]
        }
      ]
    },
    {
      "id": "phase-4-synthesize",
      "title": "Phase 4: Synthesize (Cluster + Prioritize)",
      "prompt": "Synthesize the backlog into a coherent set of themes and candidates (structured, but reflective).\n\nDoc-first: Update Clusters, Candidate directions, and Shortlist in `designDocPath`.\nChat: short recap + 'Next Input' checklist.\n\nDeliverable (bullets under headings):\n## Clusters (5–10)\n- Use clusterTemplate for each cluster\n\n## Candidate directions (top 3–7)\nFor each direction, include:\n- North Star (1–2 sentences): …\n- Summary: why now / impact / risks / migration cost\n- Scoring (1–5 with 1-line why):\n  - Impact: …\n  - Confidence: …\n  - Migration cost: …\n  - Model-robustness: …\n  - Time-to-value: …\n\n## Shortlist (2–3)\n- …\n\nReflection prompts (brief):\n- What would falsify the top direction?\n- What is the most dangerous second-order effect?\n\nAdversarial challenge (brief):\n- Argue that the top direction is wrong. What would a skeptic say?\n- What is the strongest alternative direction and why might it win?\n\nEnd with a 'Decision Gate' asking for confirmation and a 'Next Input' checklist.",
      "agentRole": "You converge: turn a large idea backlog into a small set of promising directions with clear tradeoffs.",
      "requireConfirmation": true,
      "functionReferences": ["clusterTemplate()"]
    },
    {
      "id": "phase-4a-synthesis-quality-gate",
      "title": "Phase 4A: Synthesis Quality Gate (Blueprint Enforcement)",
      "prompt": "Before prototyping, verify the core artifacts exist and are coherent.\n\nDoc-first: In `designDocPath`, add a section `## Synthesis Quality Gate` with the checklist below and mark each item ✅/❌.\nChat: only state PASS/FAIL and the top 1–3 missing items.\n\nChecklist (must be explicit):\n- POV statement is present\n- 3–7 HMW questions are present\n- Success criteria are present (measurable where possible)\n- Key tensions/tradeoffs are present\n- Idea Backlog has meaningful breadth (covers protocol/resumption/authoring/observability/reliability/tooling/packaging at least once each, if applicable)\n- Shortlist (2–3) exists with risks and migration cost noted\n- The top direction has at least one falsifiable learning question\n\nIf FAIL: list exactly what is missing and stop.",
      "agentRole": "You enforce blueprint quality. No new ideas; only validate readiness for prototyping.",
      "requireConfirmation": true
    },
    {
      "id": "phase-4b-premortem-falsification",
      "title": "Phase 4B: Pre-mortem & Falsification Criteria",
      "prompt": "Before prototyping, add a pre-mortem and explicit falsification criteria for the top direction. Treat directions as hypotheses; tests exist to falsify.\n\nDoc-first: In `designDocPath`, add a section `## Pre-mortem & Falsification` containing the deliverables below.\nChat: short recap + 'Next Input' checklist.\n\nDeliverable (bullets under headings):\n## Pre-mortem (top 5)\n- Failure mode: … | Why it happens: … | Mitigation: …\n\n## Falsification criteria (1–3)\n- If [observable outcome] happens during dogfood/test, we will [pivot/stop/change direction] because …\n\nReflection prompts (brief):\n- What is the most dangerous second-order effect?\n- What would we regret not testing?\n\nEnd with a 'Proceed to Prototype' confirmation gate.",
      "agentRole": "You pressure-test the top direction before investing in a prototype. Make failure modes and disconfirming evidence explicit.",
      "requireConfirmation": true
    },
    {
      "id": "phase-5-prototype",
      "title": "Phase 5: Prototype (Learning Artifact)",
      "prompt": "Build a low-fidelity prototype intended to answer one learning question.\n\nDoc-first: Write the full prototype spec and artifact into `designDocPath`.\nChat: short recap + 'Next Input' checklist.\n\nChoose ONE prototype artifact to produce:\n- Storyboard (6 panels)\n- Concierge script (manual end-to-end flow)\n- API sketch (request/response examples + mocked outputs)\n- Wireframe (markdown screens + interactions)\n\nDeliverable:\n- Use prototypeSpecTemplate and fill it in.\n- Include the falsification criteria from Phase 4B (copy it verbatim, then refine if needed).\n- The prototype artifact must be included in the spec under 'Prototype artifact'.\n\nReflection prompts (brief):\n- What is the smallest shippable slice that still proves the concept?\n- What is the highest-risk assumption in the spec?\n- If the falsification criteria triggers, what is the next-best direction from the shortlist?\n\nEnd with 'Next Input' checklist.",
      "agentRole": "You create a learning prototype that is testable and falsifiable, not just a concept.",
      "requireConfirmation": false,
      "functionReferences": ["prototypeSpecTemplate()"]
    },
    {
      "id": "phase-6-test-plan",
      "title": "Phase 6: Test Plan (Dogfood + Validation)",
      "prompt": "Define how to test the prototype with real usage constraints.\n\nDoc-first: Write the full test plan into `designDocPath`.\nChat: short recap + 'Next Input' checklist.\n\nDeliverable:\n- Use testPlanTemplate and fill it in.\n- Explicitly include at least: Claude + one weaker model (e.g., GPT/Grok/Gemini) in 'Agents/models/IDEs to test'.\n\nReflection prompt (brief):\n- If the test fails, what would we do next (iterate, pivot, or stop)?\n\nEnd with a 'Next Input' checklist.",
      "agentRole": "You are an experiment designer. Create a plan that produces evidence, not opinions.",
      "requireConfirmation": false,
      "functionReferences": ["testPlanTemplate()"]
    },
    {
      "id": "phase-7-test-learn-refine-loop",
      "type": "loop",
      "title": "Phase 7: Iterate (Test → Learn → Refine)",
      "loop": {
        "type": "for",
        "count": 2,
        "maxIterations": 2,
        "iterationVar": "iteration"
      },
      "body": [
        {
          "id": "test-feedback-capture",
          "title": "Iteration {{iteration}}: Test & Capture Feedback",
          "prompt": "Run a lightweight test of the prototype (dogfood, thought experiment, adversarial critique, stakeholder Q&A simulation).\n\nDoc-first: Write the full feedback capture into `designDocPath`.\nChat: short recap + 'Next Input' checklist.\n\nDeliverable:\n- Use feedbackCaptureTemplate and fill it in.\n\nEnd with 'Next Input' checklist.",
          "agentRole": "You are running a cheap, fast test intended to produce learning signals, not perfection.",
          "functionReferences": ["feedbackCaptureTemplate()"]
        },
        {
          "id": "learn-and-update",
          "title": "Iteration {{iteration}}: Learn & Update Artifacts",
          "prompt": "Based on the captured feedback, update the key artifacts.\n\nDoc-first: Apply updates to `designDocPath` and write a short `## Iteration {{iteration}}: Updates` section.\nChat: short recap + 'Next Input' checklist.\n\nDeliverable:\n## Changes made\n- POV: (what changed, if anything)\n- HMW: (what changed, if anything)\n- Shortlist: (what changed, if anything)\n- Prototype spec/artifact: (what changed, if anything)\n\n## Rationale\n- Why these changes address the feedback\n\nReflection prompts (brief):\n- What did we learn that surprised us?\n- What did we previously believe that is now false?\n\nEnd with 'Next Input' checklist.",
          "agentRole": "You are iterating based on learning. You update artifacts precisely and explain why."
        }
      ]
    }
  ]
}
