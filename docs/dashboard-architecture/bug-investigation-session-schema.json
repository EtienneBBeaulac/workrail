{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Bug Investigation Session Schema",
  "description": "Complete schema for bug investigation workflow session data",
  "type": "object",
  "required": ["dashboard", "bugSummary", "timeline"],
  "properties": {
    "dashboard": {
      "description": "High-level summary for dashboard display",
      "type": "object",
      "required": ["ticketId", "title", "status", "progress", "confidence", "currentPhase"],
      "properties": {
        "ticketId": {
          "type": "string",
          "description": "Bug ticket ID (e.g., AUTH-1234)"
        },
        "title": {
          "type": "string",
          "description": "Short bug title"
        },
        "status": {
          "type": "string",
          "enum": ["in_progress", "complete", "blocked"],
          "description": "Overall investigation status"
        },
        "progress": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Overall progress percentage"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 10,
          "description": "Confidence in root cause identification (0-10)"
        },
        "currentPhase": {
          "type": "string",
          "description": "Current phase ID (e.g., '1.2', '3a')"
        },
        "currentStep": {
          "type": "string",
          "description": "Human-readable current step"
        },
        "startedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Investigation start timestamp"
        },
        "completedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Investigation completion timestamp"
        },
        "topSuspects": {
          "type": "array",
          "maxItems": 5,
          "items": {
            "type": "string"
          },
          "description": "Top 5 suspicious components (always visible)"
        },
        "topSuspectsReasoning": {
          "type": "string",
          "description": "Why these are the top suspects"
        }
      }
    },
    
    "bugSummary": {
      "description": "Initial bug information",
      "type": "object",
      "required": ["description", "impact", "frequency"],
      "properties": {
        "description": {
          "type": "string",
          "description": "User-reported bug description"
        },
        "impact": {
          "type": "string",
          "enum": ["Critical", "High", "Medium", "Low"],
          "description": "Bug impact level"
        },
        "frequency": {
          "type": "string",
          "description": "How often the bug occurs"
        },
        "environment": {
          "type": "string",
          "description": "Environment where bug occurs"
        },
        "reproduction": {
          "type": "string",
          "description": "Steps to reproduce (if known)"
        },
        "relatedTickets": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Related ticket IDs"
        }
      }
    },
    
    "phases": {
      "description": "Data from each workflow phase",
      "type": "object",
      "properties": {
        "phase-0": {
          "type": "object",
          "properties": {
            "complete": { "type": "boolean" },
            "summary": { "type": "string" },
            "availableDocumentation": { "type": "array", "items": { "type": "string" } },
            "availableLogs": { "type": "array", "items": { "type": "string" } }
          }
        },
        "phase-1": {
          "description": "Multi-Dimensional Codebase Analysis",
          "type": "object",
          "properties": {
            "complete": { "type": "boolean" },
            "summary": { "type": "string" },
            "subsections": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["id", "title", "suspiciousComponents"],
                "properties": {
                  "id": { "type": "string", "description": "Subsection ID (1.1, 1.2, etc.)" },
                  "title": { "type": "string" },
                  "suspiciousComponents": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": ["name", "likelihood", "reasoning"],
                      "properties": {
                        "name": { "type": "string", "description": "Component/file path" },
                        "likelihood": { "type": "number", "minimum": 0, "maximum": 10 },
                        "reasoning": { "type": "string" },
                        "evidence": { "type": "array", "items": { "type": "string" } }
                      }
                    }
                  },
                  "keyFindings": { "type": "array", "items": { "type": "string" } }
                }
              }
            }
          }
        },
        "phase-2": {
          "description": "Hypothesis Development",
          "type": "object",
          "properties": {
            "complete": { "type": "boolean" },
            "summary": { "type": "string" }
          }
        },
        "phase-3": {
          "description": "Instrumentation",
          "type": "object",
          "properties": {
            "complete": { "type": "boolean" },
            "summary": { "type": "string" },
            "instrumentationPlan": { "type": "string" }
          }
        },
        "phase-4": {
          "description": "Evidence Collection",
          "type": "object",
          "properties": {
            "complete": { "type": "boolean" },
            "summary": { "type": "string" }
          }
        },
        "phase-5": {
          "description": "Hypothesis Analysis",
          "type": "object",
          "properties": {
            "complete": { "type": "boolean" },
            "summary": { "type": "string" }
          }
        },
        "phase-6": {
          "description": "Diagnostic Writeup",
          "type": "object",
          "properties": {
            "complete": { "type": "boolean" },
            "summary": { "type": "string" }
          }
        }
      }
    },
    
    "hypotheses": {
      "description": "All hypotheses generated during investigation",
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "title", "description", "likelihood", "status"],
        "properties": {
          "id": { "type": "string", "pattern": "^h\\d+$" },
          "title": { "type": "string", "maxLength": 100 },
          "description": { "type": "string" },
          "likelihood": { "type": "number", "minimum": 0, "maximum": 10 },
          "status": {
            "type": "string",
            "enum": ["pending", "active", "confirmed", "rejected"]
          },
          "basedOn": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Evidence that led to this hypothesis"
          },
          "testStrategy": { "type": "string" },
          "evidence": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "description": { "type": "string" },
                "strength": { "type": "string", "enum": ["high", "medium", "low"] },
                "source": { "type": "string" },
                "timestamp": { "type": "string", "format": "date-time" }
              }
            }
          },
          "confidence": { "type": "number", "minimum": 0, "maximum": 10 },
          "rejectionReason": { "type": "string" }
        }
      }
    },
    
    "ruledOut": {
      "description": "Components/theories ruled out with reasoning",
      "type": "array",
      "items": {
        "type": "object",
        "required": ["item", "reason", "timestamp"],
        "properties": {
          "item": { "type": "string" },
          "reason": { "type": "string" },
          "timestamp": { "type": "string", "format": "date-time" },
          "phase": { "type": "string" }
        }
      }
    },
    
    "timeline": {
      "description": "Chronological investigation timeline",
      "type": "array",
      "items": {
        "type": "object",
        "required": ["timestamp", "phase", "event"],
        "properties": {
          "timestamp": { "type": "string", "format": "date-time" },
          "phase": { "type": "string" },
          "event": { "type": "string" },
          "type": {
            "type": "string",
            "enum": ["phase_start", "phase_complete", "hypothesis_created", "hypothesis_confirmed", "hypothesis_rejected", "finding", "ruled_out"]
          }
        }
      }
    },
    
    "confidenceJourney": {
      "description": "Confidence level at each phase",
      "type": "array",
      "items": {
        "type": "object",
        "required": ["phase", "confidence", "timestamp"],
        "properties": {
          "phase": { "type": "string" },
          "confidence": { "type": "number", "minimum": 0, "maximum": 10 },
          "timestamp": { "type": "string", "format": "date-time" },
          "reasoning": { "type": "string" }
        }
      }
    },
    
    "codebaseMap": {
      "description": "Map of important files and their relationships",
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "path": { "type": "string" },
          "relatedFiles": { "type": "array", "items": { "type": "string" } },
          "purpose": { "type": "string" },
          "suspicionLevel": { "type": "number", "minimum": 0, "maximum": 10 }
        }
      }
    },
    
    "rootCause": {
      "description": "Final root cause determination (Phase 6)",
      "type": "object",
      "properties": {
        "identified": { "type": "boolean" },
        "confidence": { "type": "number", "minimum": 0, "maximum": 10 },
        "description": { "type": "string" },
        "location": { "type": "string" },
        "mechanism": { "type": "string" },
        "whyNowDiscovered": { "type": "string" },
        "evidence": { "type": "array", "items": { "type": "string" } }
      }
    },
    
    "fix": {
      "description": "Proposed fix (Phase 6)",
      "type": "object",
      "properties": {
        "approach": { "type": "string" },
        "filesAffected": { "type": "array", "items": { "type": "string" } },
        "risks": { "type": "array", "items": { "type": "string" } },
        "testingStrategy": { "type": "string" },
        "alternatives": { "type": "array", "items": { "type": "string" } }
      }
    },
    
    "recommendations": {
      "description": "Next investigations if confidence < 9.0",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "priority": { "type": "number", "minimum": 1, "maximum": 10 },
          "description": { "type": "string" },
          "reasoning": { "type": "string" }
        }
      }
    },
    
    "metadata": {
      "description": "Session metadata",
      "type": "object",
      "properties": {
        "workflowVersion": { "type": "string" },
        "totalPhases": { "type": "number" },
        "totalSteps": { "type": "number" },
        "totalTokensUsed": { "type": "number" }
      }
    }
  }
}

