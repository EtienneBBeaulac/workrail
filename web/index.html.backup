<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workrail Dashboard</title>
    
    <!-- Design System v1.2 -->
    <link rel="stylesheet" href="/assets/design-system.css">
    <link rel="stylesheet" href="/assets/components.css">
    <link rel="stylesheet" href="/assets/animations.css">
    <link rel="stylesheet" href="/assets/styles.css">
    <link rel="stylesheet" href="/assets/theme-toggle.css">
    
    <!-- Theme Management -->
    <script src="/assets/theme-manager.js"></script>
    <script src="/assets/theme-toggle.js"></script>
    
    <!-- Background Effects -->
    <link rel="stylesheet" href="/assets/background-effects.css">
    <script src="/assets/time-of-day-theme.js"></script>
    <script src="/assets/particle-generator.js"></script>
    <script src="/assets/background-interaction.js"></script>
    
    <!-- Component Library (Jetpack Compose-style components) -->
    <script src="/assets/components.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            background: linear-gradient(135deg, 
                rgba(249, 250, 251, 1) 0%,
                rgba(243, 244, 246, 1) 50%,
                rgba(249, 250, 251, 1) 100%);
            min-height: 100vh;
            padding: var(--space-8) 0;
            margin: 0;
        }
        [data-theme="dark"] body {
            background: linear-gradient(135deg, 
                #0f1419 0%,
                #18181b 50%,
                #0f1419 100%);
        }
        .home-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-6);
            position: relative;
            z-index: 1;
        }
        @media (max-width: 768px) {
            .home-container {
                padding: 0 var(--space-4);
            }
        }
        .hero {
            text-align: center;
            padding: var(--space-20) var(--space-8);
            background: linear-gradient(135deg, 
                rgba(102, 126, 234, 0.95) 0%, 
                rgba(118, 75, 162, 0.95) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: var(--radius-2xl);
            margin-bottom: var(--space-10);
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.4),
                        0 8px 16px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }
        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, 
                rgba(255, 255, 255, 0.1) 0%, 
                transparent 70%);
            animation: heroGlow 8s ease-in-out infinite;
            z-index: 0;
        }
        .hero::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.1) 0%, 
                transparent 50%, 
                rgba(0, 0, 0, 0.1) 100%);
            pointer-events: none;
            z-index: 1;
        }
        @keyframes heroGlow {
            0%, 100% { transform: translate(-25%, -25%) scale(1); opacity: 0.5; }
            50% { transform: translate(-30%, -30%) scale(1.1); opacity: 0.8; }
        }
        [data-theme="dark"] .hero {
            background: linear-gradient(135deg, 
                rgba(102, 126, 234, 0.35) 0%, 
                rgba(118, 75, 162, 0.35) 100%);
            border-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3),
                        0 8px 16px rgba(0, 0, 0, 0.5);
        }
        .hero h1 {
            font-size: var(--text-4xl);
            font-weight: var(--font-bold);
            margin-bottom: var(--space-4);
            position: relative;
            z-index: 2;
            color: white;
            text-shadow: 0 2px 20px rgba(0, 0, 0, 0.2);
            animation: fadeInDown 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .hero h1 i {
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.2));
        }
        .hero p {
            font-size: var(--text-xl);
            opacity: 0.95;
            color: rgba(255, 255, 255, 0.95);
            position: relative;
            z-index: 2;
            text-shadow: 0 1px 8px rgba(0, 0, 0, 0.2);
            animation: fadeInUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) 0.2s both;
        }
        [data-theme="dark"] .hero h1,
        [data-theme="dark"] .hero p {
            color: white;
            text-shadow: 0 2px 12px rgba(0, 0, 0, 0.5);
        }
        .sessions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: var(--space-6);
        }
        .session-card {
            background: var(--glass-bg-strong);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: var(--space-6);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            border: 2px solid transparent;
            border-left: 4px solid var(--primary-500);
            position: relative;
            cursor: pointer;
            transition: transform var(--duration-base) var(--ease-spring),
                        box-shadow var(--duration-base) var(--ease-spring),
                        backdrop-filter var(--duration-base) var(--ease-spring),
                        border-color var(--duration-base) var(--ease-spring);
            animation: fadeInUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) both;
        }
        .session-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                var(--primary-500), 
                var(--accent-cyan), 
                var(--primary-500));
            opacity: 0;
            transition: opacity var(--duration-base) var(--ease-spring);
        }
        .session-card:hover::before {
            opacity: 1;
        }
        .session-card:nth-child(1) { animation-delay: 0.1s; border-left-color: var(--accent-purple); }
        .session-card:nth-child(2) { animation-delay: 0.2s; border-left-color: var(--accent-cyan); }
        .session-card:nth-child(3) { animation-delay: 0.3s; border-left-color: var(--accent-pink); }
        .session-card:nth-child(4) { animation-delay: 0.4s; border-left-color: var(--accent-orange); }
        .session-card:nth-child(5) { animation-delay: 0.5s; border-left-color: var(--accent-green); }
        .session-card:nth-child(6) { animation-delay: 0.6s; border-left-color: var(--accent-blue); }
        .session-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15),
                        0 0 0 1px var(--glass-border-strong);
            backdrop-filter: blur(20px) saturate(180%);
            border-left-width: 6px;
        }
        .session-card:hover .session-menu-btn {
            opacity: 1;
        }
        .session-menu-btn {
            position: absolute;
            top: var(--space-2);
            right: var(--space-2);
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: var(--text-tertiary);
            border-radius: var(--radius-md);
            font-size: var(--text-lg);
            line-height: 1;
            cursor: pointer;
            opacity: 0;
            transition: opacity var(--duration-fast) var(--ease-out),
                        background var(--duration-fast) var(--ease-out),
                        color var(--duration-fast) var(--ease-out);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            font-weight: var(--font-bold);
            letter-spacing: 1px;
        }
        .session-menu-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }
        .session-menu-btn.active {
            opacity: 1;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }
        .session-menu-dropdown {
            position: absolute;
            top: 45px;
            right: var(--space-2);
            background: var(--glass-bg-strong);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            min-width: 160px;
            z-index: 100;
            overflow: hidden;
            animation: springIn 0.3s var(--ease-spring);
        }
        .session-menu-item {
            padding: var(--space-3) var(--space-4);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-sm);
            color: var(--text-primary);
            transition: background var(--duration-fast) var(--ease-out),
                        color var(--duration-fast) var(--ease-out);
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
        }
        .session-menu-item:hover {
            background: rgba(244, 67, 54, 0.1);
            color: var(--status-error);
        }
        .session-menu-item svg {
            flex-shrink: 0;
        }
        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
        }
        .session-id {
            font-size: var(--text-lg);
            font-weight: var(--font-bold);
            color: var(--text-primary);
        }
        .session-status {
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: var(--font-bold);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            position: relative;
            overflow: hidden;
        }
        .session-status::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            transition: left 0.5s;
        }
        .session-card:hover .session-status::before {
            left: 100%;
        }
        .status-in_progress {
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.2), 
                rgba(99, 102, 241, 0.2));
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 0 12px rgba(59, 130, 246, 0.2);
        }
        .status-complete {
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.2), 
                rgba(5, 150, 105, 0.2));
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
            box-shadow: 0 0 12px rgba(16, 185, 129, 0.2);
        }
        .session-title {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            margin-bottom: var(--space-4);
            line-height: 1.5;
        }
        .session-meta {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-3);
            padding-top: var(--space-4);
            border-top: 1px solid var(--border-light);
        }
        .meta-item {
            font-size: var(--text-xs);
        }
        .meta-label {
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-1);
            font-size: 10px;
        }
        .meta-value {
            color: var(--text-primary);
            font-weight: var(--font-semibold);
        }
        .confidence-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            overflow: hidden;
            margin-top: var(--space-1);
        }
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, 
                var(--status-error), 
                var(--status-pending), 
                var(--status-success));
            transition: width var(--duration-base) var(--ease-spring);
        }
        
        /* Modal Dialog */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn var(--duration-base) var(--ease-out);
        }
        .modal-overlay.show {
            display: flex;
        }
        .modal-dialog {
            background: var(--glass-bg-strong);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-2xl);
            max-width: 450px;
            width: 90%;
            padding: var(--space-8);
            box-shadow: var(--shadow-2xl);
            animation: springIn 0.4s var(--ease-spring);
        }
        .modal-icon {
            font-size: var(--text-4xl);
            text-align: center;
            margin-bottom: var(--space-4);
        }
        .modal-title {
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            text-align: center;
            margin-bottom: var(--space-3);
            color: var(--text-primary);
        }
        .modal-message {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: var(--space-2);
            line-height: 1.6;
            font-size: var(--text-base);
        }
        .modal-session-info {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--space-3) var(--space-4);
            margin: var(--space-4) 0 var(--space-5);
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Courier New', monospace;
            font-size: var(--text-sm);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
        }
        .modal-warning {
            text-align: center;
            color: var(--status-error);
            font-size: var(--text-sm);
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-6);
        }
        .modal-actions {
            display: flex;
            gap: var(--space-3);
            justify-content: center;
        }
        .modal-btn {
            padding: var(--space-3) var(--space-6);
            border: none;
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            font-weight: var(--font-semibold);
            cursor: pointer;
            transition: all var(--duration-fast) var(--ease-spring);
        }
        .modal-btn-cancel {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-medium);
        }
        .modal-btn-cancel:hover {
            background: var(--bg-secondary);
            transform: translateY(-2px);
        }
        .modal-btn-delete {
            background: var(--status-error);
            color: white;
        }
        .modal-btn-delete:hover {
            background: #d32f2f;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        .modal-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Clear Completed Button */
        .clear-completed-btn {
            padding: var(--space-2) var(--space-3);
            background: transparent;
            color: var(--text-tertiary);
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: all var(--duration-fast) var(--ease-spring);
            white-space: nowrap;
        }
        .clear-completed-btn:hover {
            color: var(--status-error);
            background: rgba(244, 67, 54, 0.08);
        }
        .clear-completed-btn:active {
            transform: scale(0.98);
            background: rgba(244, 67, 54, 0.12);
        }
        
        .empty-message {
            text-align: center;
            padding: var(--space-16) var(--space-5);
            color: var(--text-tertiary);
        }
        .empty-message-icon {
            font-size: var(--text-4xl);
            margin-bottom: var(--space-4);
        }
        .empty-message h2 {
            font-size: var(--text-2xl);
            margin-bottom: var(--space-2);
            color: var(--text-secondary);
        }
        
        /* Onboarding Styles */
        .onboarding-container {
            max-width: 900px;
            margin: 0 auto;
            grid-column: 1 / -1;
            animation: fadeInUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .onboarding-hero {
            text-align: center;
            padding: var(--space-16) var(--space-5) var(--space-10);
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-2xl);
            margin-bottom: var(--space-8);
            position: relative;
            overflow: hidden;
        }
        .onboarding-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(102, 126, 234, 0.05) 0%, 
                rgba(118, 75, 162, 0.05) 100%);
            z-index: -1;
        }
        .onboarding-icon {
            font-size: var(--text-4xl);
            margin-bottom: var(--space-5);
            animation: float 3s ease-in-out infinite;
        }
        .onboarding-hero h2 {
            font-size: var(--text-3xl);
            font-weight: var(--font-bold);
            color: var(--text-primary);
            margin-bottom: var(--space-3);
        }
        .onboarding-subtitle {
            font-size: var(--text-lg);
            color: var(--text-secondary);
            margin: 0;
        }
        .onboarding-content {
            display: flex;
            flex-direction: column;
            gap: var(--space-6);
        }
        .onboarding-section {
            background: var(--glass-bg-strong);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            padding: var(--space-8);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            transition: box-shadow var(--duration-base) var(--ease-spring),
                        transform var(--duration-base) var(--ease-spring);
        }
        .onboarding-section:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        .onboarding-section h3 {
            font-size: var(--text-xl);
            font-weight: var(--font-bold);
            margin-bottom: var(--space-4);
            color: var(--text-primary);
        }
        .onboarding-section p {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: var(--space-3);
            font-size: var(--text-base);
        }
        .onboarding-section p:last-child {
            margin-bottom: 0;
        }
        .code-block {
            background: var(--bg-secondary);
            border: 1px solid var(--border-medium);
            border-left: 4px solid var(--primary-500);
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            margin: 16px 0;
            overflow-x: auto;
        }
        .code-block code {
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 14px;
            color: #495057;
        }
        .hint {
            font-size: 14px;
            color: #6c757d;
            font-style: italic;
        }
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .feature-item {
            display: flex;
            gap: 12px;
            align-items: start;
        }
        .feature-icon {
            font-size: 28px;
            flex-shrink: 0;
        }
        .feature-text strong {
            display: block;
            color: #2c3e50;
            margin-bottom: 4px;
        }
        .feature-text p {
            font-size: 14px;
            color: #7f8c8d;
            margin: 0;
        }
        .onboarding-cta {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
        }
        .onboarding-cta h3 {
            color: white;
        }
        .onboarding-cta p {
            color: rgba(255, 255, 255, 0.95);
        }
        .onboarding-cta code {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
        }
        .auto-refresh-notice {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 16px;
            border-radius: 20px;
            margin-top: 16px;
            font-size: 14px;
        }
        .pulse-dot {
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
        .project-info {
            background: var(--glass-bg-strong);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: var(--space-6);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--glass-border);
            margin-bottom: var(--space-8);
            animation: fadeInUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .project-info h2 {
            font-size: var(--text-xl);
            font-weight: var(--font-bold);
            margin-bottom: var(--space-4);
            color: var(--text-primary);
        }
        .project-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
        }
        .detail-item {
            padding: var(--space-4);
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
            transition: all var(--duration-fast) var(--ease-spring);
        }
        .detail-item:hover {
            background: var(--bg-tertiary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }
        .detail-label {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: var(--space-2);
            font-weight: var(--font-semibold);
        }
        .detail-value {
            font-size: var(--text-sm);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            word-break: break-all;
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <svg class="bg-orbs" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid slice">
        <defs>
            <filter id="orb-blur-home" x="-100%" y="-100%" width="300%" height="300%">
                <feGaussianBlur in="SourceGraphic" stdDeviation="3"/>
            </filter>
        </defs>
        
        <!-- Orbs - Light Mode -->
        <g class="orbs-light">
            <circle cx="15" cy="15" r="8" fill="rgba(6, 182, 212, 0.4)" filter="url(#orb-blur-home)">
                <animate attributeName="cx" values="15;18;12;15" dur="20s" repeatCount="indefinite"/>
                <animate attributeName="cy" values="15;18;12;15" dur="20s" repeatCount="indefinite"/>
            </circle>
            <circle cx="85" cy="10" r="10" fill="rgba(139, 92, 246, 0.4)" filter="url(#orb-blur-home)">
                <animate attributeName="cx" values="85;82;88;85" dur="25s" repeatCount="indefinite"/>
                <animate attributeName="cy" values="10;13;7;10" dur="25s" repeatCount="indefinite"/>
            </circle>
            <circle cx="20" cy="85" r="9" fill="rgba(236, 72, 153, 0.4)" filter="url(#orb-blur-home)">
                <animate attributeName="cx" values="20;17;23;20" dur="22s" repeatCount="indefinite"/>
                <animate attributeName="cy" values="85;82;88;85" dur="22s" repeatCount="indefinite"/>
            </circle>
            <circle cx="85" cy="80" r="7" fill="rgba(249, 115, 22, 0.4)" filter="url(#orb-blur-home)">
                <animate attributeName="cx" values="85;88;82;85" dur="18s" repeatCount="indefinite"/>
                <animate attributeName="cy" values="80;83;77;80" dur="18s" repeatCount="indefinite"/>
            </circle>
        </g>
        
        <!-- Orbs - Dark Mode (higher opacity) -->
        <g class="orbs-dark" style="display: none;">
            <circle cx="15" cy="15" r="8" fill="rgba(6, 182, 212, 0.3)" filter="url(#orb-blur-home)">
                <animate attributeName="cx" values="15;18;12;15" dur="20s" repeatCount="indefinite"/>
                <animate attributeName="cy" values="15;18;12;15" dur="20s" repeatCount="indefinite"/>
            </circle>
            <circle cx="85" cy="10" r="10" fill="rgba(139, 92, 246, 0.35)" filter="url(#orb-blur-home)">
                <animate attributeName="cx" values="85;82;88;85" dur="25s" repeatCount="indefinite"/>
                <animate attributeName="cy" values="10;13;7;10" dur="25s" repeatCount="indefinite"/>
            </circle>
            <circle cx="20" cy="85" r="9" fill="rgba(236, 72, 153, 0.3)" filter="url(#orb-blur-home)">
                <animate attributeName="cx" values="20;17;23;20" dur="22s" repeatCount="indefinite"/>
                <animate attributeName="cy" values="85;82;88;85" dur="22s" repeatCount="indefinite"/>
            </circle>
            <circle cx="85" cy="80" r="7" fill="rgba(249, 115, 22, 0.3)" filter="url(#orb-blur-home)">
                <animate attributeName="cx" values="85;88;82;85" dur="18s" repeatCount="indefinite"/>
                <animate attributeName="cy" values="80;83;77;80" dur="18s" repeatCount="indefinite"/>
            </circle>
        </g>
    </svg>
    
    <style>
        /* Show/hide orbs based on theme */
        [data-theme="dark"] .orbs-light { display: none; }
        [data-theme="dark"] .orbs-dark { display: block !important; }
    </style>
    
    <!-- Workflow Rails & Nodes -->
    <div class="bg-rails">
        <div class="rail-path rail-h1">
            <svg viewBox="0 0 1400 100" preserveAspectRatio="none">
                <path d="M0,50 Q350,20 700,50 T1400,50" stroke="rgba(139, 92, 246, 0.3)" stroke-width="2" fill="none"/>
            </svg>
        </div>
        <div class="rail-path rail-h2">
            <svg viewBox="0 0 1400 100" preserveAspectRatio="none">
                <path d="M0,50 Q350,80 700,50 T1400,50" stroke="rgba(6, 182, 212, 0.3)" stroke-width="2" fill="none"/>
            </svg>
        </div>
        <div class="rail-path rail-d1"></div>
        <div class="rail-path rail-d2"></div>
    </div>
    
    <!-- Workflow Nodes -->
    <div class="workflow-node node-1"></div>
    <div class="workflow-node node-2"></div>
    <div class="workflow-node node-3"></div>
    <div class="workflow-node node-4"></div>
    <div class="workflow-node node-5"></div>
    
    <!-- Particle Container -->
    <div class="bg-particles"></div>
    
    <div class="home-container">
        <div class="hero">
            <h1><i data-lucide="rocket" style="width: 42px; height: 42px; display: inline-block; vertical-align: middle; margin-right: 12px;"></i>Workrail Dashboard</h1>
            <p>Real-time workflow execution tracking and visualization</p>
        </div>

        <div id="projectInfo" class="project-info">
            <h2>Current Project</h2>
            <div class="project-details">
                <div class="detail-item">
                    <div class="detail-label">Project ID</div>
                    <div class="detail-value" id="projectId">Loading...</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Project Path</div>
                    <div class="detail-value" id="projectPath">Loading...</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Active Sessions</div>
                    <div class="detail-value" id="sessionCount">Loading...</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Last Updated</div>
                    <div class="detail-value" id="projectUpdated">Loading...</div>
                </div>
            </div>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 24px;">
            <h2 style="margin: 0; font-size: 24px; color: #2c3e50;">Active Sessions</h2>
            <button id="clearCompletedBtn" 
                    class="clear-completed-btn" 
                    onclick="confirmClearCompleted()"
                    style="display: none;">
                Clear <span id="completedCount">0</span> completed
            </button>
        </div>
        <div id="sessionsContainer" class="sessions-grid">
            <div class="empty-message">
                <div class="empty-message-icon">‚è≥</div>
                <h2>Loading sessions...</h2>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        
        async function loadData() {
            await Promise.all([
                loadProjectInfo(),
                loadSessions()
            ]);
        }

        async function loadProjectInfo() {
            try {
                const response = await fetch(`${API_BASE}/api/current-project`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                
                // API returns { success: true, project: { id, path, ... } }
                const project = data.project || data;
                
                document.getElementById('projectId').textContent = project.id || 'Loading...';
                document.getElementById('projectPath').textContent = project.path || 'No project loaded yet';
                document.getElementById('sessionCount').textContent = project.sessionCount !== undefined ? project.sessionCount : 0;
                
                // Handle date safely
                const updatedAt = project.updatedAt ? new Date(project.updatedAt) : new Date();
                document.getElementById('projectUpdated').textContent = isNaN(updatedAt.getTime()) 
                    ? 'Just now' 
                    : updatedAt.toLocaleString();
            } catch (error) {
                console.error('Error loading project info:', error);
            }
        }

        async function loadSessions() {
            try {
                const response = await fetch(`${API_BASE}/api/sessions`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                
                // API returns { success: true, sessions: [], count: 0 }
                const sessions = data.sessions || data || [];
                
                const container = document.getElementById('sessionsContainer');
                
                if (sessions.length === 0) {
                    container.innerHTML = `
                        <div class="onboarding-container">
                            <div class="onboarding-hero">
                                <div class="onboarding-icon">
                                    <i data-lucide="rocket" style="width: 64px; height: 64px;"></i>
                                </div>
                                <h2>Welcome to Workrail Dashboard</h2>
                                <p class="onboarding-subtitle">Real-time workflow execution tracking and visualization</p>
                            </div>
                            
                            <div class="onboarding-content">
                                <div class="onboarding-section">
                                    <h3><i data-lucide="bar-chart" style="width: 20px; height: 20px; display: inline-block; vertical-align: middle; margin-right: 8px;"></i>What is this?</h3>
                                    <p>This dashboard provides real-time monitoring of your workflow executions. Watch as AI agents work through complex tasks like bug investigations, code reviews, and documentation creation.</p>
                                </div>
                                
                                <div class="onboarding-section">
                                    <h3><i data-lucide="target" style="width: 20px; height: 20px; display: inline-block; vertical-align: middle; margin-right: 8px;"></i>Getting Started</h3>
                                    <p>To see the dashboard in action, have an AI agent execute a workflow. For example, try the bug investigation workflow:</p>
                                    <div class="code-block">
                                        <code>workrail_create_session("bug-investigation", "YOUR-TICKET-ID", {...})</code>
                                    </div>
                                    <p class="hint">üí° The agent will automatically call this when starting an investigation</p>
                                </div>
                                
                                <div class="onboarding-section">
                                    <h3><i data-lucide="sparkles" style="width: 20px; height: 20px; display: inline-block; vertical-align: middle; margin-right: 8px;"></i>What you'll see:</h3>
                                    <div class="features-grid">
                                        <div class="feature-item">
                                            <span class="feature-icon">
                                                <i data-lucide="trending-up" style="width: 24px; height: 24px;"></i>
                                            </span>
                                            <div class="feature-text">
                                                <strong>Progress Tracking</strong>
                                                <p>Watch progress from 0% to 100%</p>
                                            </div>
                                        </div>
                                        <div class="feature-item">
                                            <span class="feature-icon">
                                                <i data-lucide="lightbulb" style="width: 24px; height: 24px;"></i>
                                            </span>
                                            <div class="feature-text">
                                                <strong>Hypothesis Evolution</strong>
                                                <p>See theories develop and get validated</p>
                                            </div>
                                        </div>
                                        <div class="feature-item">
                                            <span class="feature-icon">
                                                <i data-lucide="clock" style="width: 24px; height: 24px;"></i>
                                            </span>
                                            <div class="feature-text">
                                                <strong>Live Timeline</strong>
                                                <p>Track events as they happen</p>
                                            </div>
                                        </div>
                                        <div class="feature-item">
                                            <span class="feature-icon">
                                                <i data-lucide="bar-chart-2" style="width: 24px; height: 24px;"></i>
                                            </span>
                                            <div class="feature-text">
                                                <strong>Confidence Journey</strong>
                                                <p>See confidence grow with evidence</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="onboarding-section onboarding-cta">
                                    <h3>üß™ Ready to start?</h3>
                                    <p>Just tell your AI agent to investigate a bug or execute any Workrail workflow - the dashboard will automatically populate!</p>
                                    <div class="auto-refresh-notice">
                                        <span class="pulse-dot"></span>
                                        Dashboard auto-refreshes every 5 seconds
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = sessions.map(session => {
                    const dashboard = session.data?.dashboard || {};
                    const status = dashboard.status || 'in_progress';
                    const progress = dashboard.progress || 0;
                    const confidence = dashboard.confidence || 0;
                    const title = dashboard.title || session.id;
                    
                    return `
                        <div class="session-card" onclick="openSession('${session.workflowId}', '${session.id}')">
                            <button class="session-menu-btn"
                                    onclick="event.stopPropagation(); toggleSessionMenu(this, '${session.workflowId}', '${escapeHtml(session.id)}', '${escapeHtml(title)}')"
                                    title="Session options"
                                    aria-label="Session options">
                                <i data-lucide="more-vertical" style="width: 20px; height: 20px;"></i>
                            </button>
                            <div class="session-header">
                                <div class="session-id">${escapeHtml(session.id)}</div>
                                <div class="session-status status-${status}">${status.replace('_', ' ')}</div>
                            </div>
                            <div class="session-title">${escapeHtml(title)}</div>
                            <div class="session-meta">
                                <div class="meta-item">
                                    <div class="meta-label">Progress</div>
                                    <div class="meta-value">${progress}%</div>
                                </div>
                                <div class="meta-item">
                                    <div class="meta-label">Confidence</div>
                                    <div class="meta-value">${confidence.toFixed(1)}/10</div>
                                    <div class="confidence-bar">
                                        <div class="confidence-fill" style="width: ${(confidence / 10) * 100}%"></div>
                                    </div>
                                </div>
                                <div class="meta-item">
                                    <div class="meta-label">Current Phase</div>
                                    <div class="meta-value">${dashboard.currentPhase || '--'}</div>
                                </div>
                                <div class="meta-item">
                                    <div class="meta-label">Updated</div>
                                    <div class="meta-value">${formatTime(session.updatedAt)}</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Update "Clear Completed" button
                const completedCount = sessions.filter(s => s.data?.dashboard?.status === 'complete').length;
                const clearBtn = document.getElementById('clearCompletedBtn');
                const countSpan = document.getElementById('completedCount');
                
                if (completedCount > 0) {
                    clearBtn.style.display = 'block';
                    countSpan.textContent = completedCount;
                } else {
                    clearBtn.style.display = 'none';
                }
            } catch (error) {
                console.error('Error loading sessions:', error);
                document.getElementById('sessionsContainer').innerHTML = `
                    <div class="empty-message">
                        <div class="empty-message-icon">‚ùå</div>
                        <h2>Error Loading Sessions</h2>
                        <p>${escapeHtml(error.message)}</p>
                    </div>
                `;
            }
        }

        function openSession(workflowId, sessionId) {
            // Route to workflow-specific dashboard (v3 - modern scaffold system)
            // Support both workflow IDs (short and full names)
            if (workflowId === 'bug-investigation' || workflowId === 'systematic-bug-investigation-with-loops') {
                window.location.href = `/workflows/bug-investigation/dashboard-v3.html?workflow=${encodeURIComponent(workflowId)}&id=${encodeURIComponent(sessionId)}`;
            } else {
                // Default to generic view (to be implemented for other workflows)
                alert(`Dashboard for workflow "${workflowId}" not yet implemented. Session ID: ${sessionId}`);
                return false;
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatTime(timestamp) {
            if (!timestamp) return 'N/A';
            const date = new Date(timestamp);
            if (isNaN(date.getTime())) return 'N/A';
            return date.toLocaleTimeString();
        }

        // Initial load
        // Delete session functions
        function toggleSessionMenu(button, workflowId, sessionId, title) {
            // Close any other open menus
            document.querySelectorAll('.session-menu-dropdown').forEach(menu => menu.remove());
            document.querySelectorAll('.session-menu-btn.active').forEach(btn => btn.classList.remove('active'));
            
            // Check if we're closing this menu
            if (button.classList.contains('active')) {
                button.classList.remove('active');
                return;
            }
            
            // Create dropdown
            const dropdown = document.createElement('div');
            dropdown.className = 'session-menu-dropdown';
            dropdown.innerHTML = `
                <button class="session-menu-item" onclick="event.stopPropagation(); confirmDeleteSession('${workflowId}', '${sessionId}', '${title}')">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M2 4h12M5.333 4V2.667a1.333 1.333 0 0 1 1.334-1.334h2.666a1.333 1.333 0 0 1 1.334 1.334V4m2 0v9.333a1.333 1.333 0 0 1-1.334 1.334H4.667a1.333 1.333 0 0 1-1.334-1.334V4h9.334Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Delete Session
                </button>
            `;
            
            button.classList.add('active');
            button.parentElement.appendChild(dropdown);
            
            // Close menu when clicking outside
            setTimeout(() => {
                document.addEventListener('click', closeAllMenus, { once: true });
            }, 0);
        }
        
        function closeAllMenus() {
            document.querySelectorAll('.session-menu-dropdown').forEach(menu => menu.remove());
            document.querySelectorAll('.session-menu-btn.active').forEach(btn => btn.classList.remove('active'));
        }
        
        function confirmDeleteSession(workflowId, sessionId, title) {
            closeAllMenus();
            showModal({
                icon: 'alert-circle',
                title: 'Delete Session?',
                message: `Are you sure you want to delete this session?`,
                sessionInfo: `${sessionId}\n${title || workflowId}`,
                warning: 'This action cannot be undone.',
                confirmText: 'Delete Session',
                onConfirm: () => deleteSession(workflowId, sessionId)
            });
        }

        async function deleteSession(workflowId, sessionId) {
            try {
                const response = await fetch(`${API_BASE}/api/sessions/${workflowId}/${sessionId}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                // Reload sessions
                await loadSessions();
                
                showToast('Session deleted successfully', 'success');
            } catch (error) {
                console.error('Error deleting session:', error);
                showToast('Failed to delete session', 'error');
            }
        }

        function showModal({ icon, title, message, sessionInfo, warning, confirmText, onConfirm }) {
            const modal = document.getElementById('deleteModal');
            
            // Update icon (using Lucide)
            const iconEl = modal.querySelector('.modal-icon');
            iconEl.innerHTML = `<i data-lucide="${icon}" style="width: 48px; height: 48px;"></i>`;
            lucide.createIcons({ icons: { [icon]: lucide[icon] } });
            
            modal.querySelector('.modal-title').textContent = title;
            modal.querySelector('.modal-message').textContent = message;
            modal.querySelector('.modal-session-info').textContent = sessionInfo;
            modal.querySelector('.modal-warning').textContent = warning;
            
            const confirmBtn = modal.querySelector('.modal-btn-delete');
            confirmBtn.textContent = confirmText;
            
            // Remove old listeners
            const newConfirmBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
            
            newConfirmBtn.addEventListener('click', () => {
                onConfirm();
                hideModal();
            });
            
            modal.classList.add('show');
        }

        function hideModal() {
            document.getElementById('deleteModal').classList.remove('show');
        }

        function showToast(message, type = 'info') {
            // Simple toast notification (can be enhanced)
            console.log(`[${type.toUpperCase()}] ${message}`);
            // TODO: Add visual toast notification
        }

        async function confirmClearCompleted() {
            // Get current sessions to count completed
            const response = await fetch(`${API_BASE}/api/sessions`);
            const data = await response.json();
            const sessions = data.sessions || data || [];
            const completedSessions = sessions.filter(s => s.data?.dashboard?.status === 'complete');
            
            if (completedSessions.length === 0) {
                showToast('No completed sessions to delete', 'info');
                return;
            }
            
            showModal({
                icon: 'trash-2',
                title: 'Clear Completed Sessions?',
                message: `This will delete all ${completedSessions.length} completed session(s).`,
                sessionInfo: completedSessions.map(s => s.id).join(', '),
                warning: 'This action cannot be undone.',
                confirmText: `Delete ${completedSessions.length} Session(s)`,
                onConfirm: () => clearCompletedSessions(completedSessions)
            });
        }

        async function clearCompletedSessions(sessions) {
            try {
                const sessionsToDelete = sessions.map(s => ({
                    workflowId: s.workflowId,
                    sessionId: s.id
                }));
                
                const response = await fetch(`${API_BASE}/api/sessions/bulk-delete`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ sessions: sessionsToDelete })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                // Reload sessions
                await loadSessions();
                
                showToast(`Deleted ${sessionsToDelete.length} session(s) successfully`, 'success');
            } catch (error) {
                console.error('Error clearing completed sessions:', error);
                showToast('Failed to clear completed sessions', 'error');
            }
        }

        loadData();

        // Auto-refresh every 5 seconds
        setInterval(loadData, 5000);
    </script>
    
    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal-overlay">
        <div class="modal-dialog">
            <div class="modal-icon">
                <i data-lucide="alert-circle" style="width: 48px; height: 48px;"></i>
            </div>
            <h2 class="modal-title">Delete Session?</h2>
            <p class="modal-message">Are you sure you want to delete this session?</p>
            <div class="modal-session-info">Session ID</div>
            <p class="modal-warning">This action cannot be undone.</p>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" onclick="hideModal()">Cancel</button>
                <button class="modal-btn modal-btn-delete">Delete Session</button>
            </div>
        </div>
    </div>
    
    <script>
        // Setup event listeners after modal HTML is loaded
        document.getElementById('deleteModal').addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                hideModal();
            }
        });
    </script>
    
    <script>
        // Initialize Lucide icons on page load and after dynamic content updates
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });
        
        // Wrap loadSessions to reinitialize icons after updates
        (function() {
            const originalLoadSessions = window.loadSessions;
            window.loadSessions = async function() {
                await originalLoadSessions();
                setTimeout(() => lucide.createIcons(), 100);
            };
        })();
    </script>
    
    <!-- Initialize Background Effects -->
    <script>
        // Generate particles on page load
        if (typeof generateParticles === 'function') {
            generateParticles(8); // 8 particles for homepage
        }
    </script>
</body>
</html>
